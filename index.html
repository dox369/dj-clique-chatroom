<html>
<head>


  <style>



   * { margin: 0; padding: 0; box-sizing: border-box; }

      body { font: 13px Helvetica, Arial; }

      form { background: #000; padding: 3px;  bottom: 0; width: 100%; position: fixed;}
//position: fixed;

      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }

      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; align:right; float:right; }

      #messages { list-style-type: none; margin: 0; padding: 0; }

      #messages li { padding: 5px 10px; }

      #messages li:nth-child(odd) { background: #eee; }

/* Fix user-agent */



* {

  box-sizing: border-box;

}



html {

  font-weight: 300;

  -webkit-font-smoothing: antialiased;

}



html, input {

  font-family:

    "HelveticaNeue-Light",

    "Helvetica Neue Light",

    "Helvetica Neue",

    Helvetica,

    Arial,

    "Lucida Grande",

    sans-serif;

}



html, body {

  height: 100%;

  margin: 0;

  padding: 0;

}



ul {

  list-style: none;

  word-wrap: break-word;

}



/* Pages */



.pages {

  height: 100%;

  margin: 0;

  padding: 0;

  width: 100%;

}



.page {

  height: 100%;

  position: absolute;

  width: 100%;

}



/* Login Page */



.login.page {

  background-color: #000;

}



.login.page .form {

  height: 100px;

  margin-top: -100px;

  position: absolute;



  text-align: center;

  top: 50%;

  width: 100%;

}



.login.page .form .usernameInput {

  background-color: transparent;

  border: none;

  border-bottom: 2px solid #fff;

  outline: none;

  padding-bottom: 15px;

  text-align: center;

  width: 400px;

}



.login.page .title {

  font-size: 200%;

}



.login.page .usernameInput {

  font-size: 200%;

  letter-spacing: 3px;

}



.login.page .title, .login.page .usernameInput {

  color: #fff;

  font-weight: 100;

}



/* Chat page */



.chat.page {

  display: none;

}



/* Font */



.messages {

  font-size: 150%;

}



.inputMessage {

  font-size: 100%;

}



.log {

  color: gray;

  font-size: 70%;

  margin: 5px;

  text-align: center;

}



/* Messages */



.chatArea {

  height: 100%;

  padding-bottom: 60px;

}



.messages {

  height: 100%;

  margin: 0;

  overflow-y: scroll;

  padding: 10px 20px 10px 20px;

}



.message.typing .messageBody {

  color: gray;

}



.username {

  font-weight: 700;

  overflow: hidden;

  padding-right: 15px;

  text-align: right;

}



/* Input */



.inputMessage {

  border: 10px solid #000;

  bottom: 0;

  height: 60px;

  left: 0;

  outline: none;

  padding-left: 10px;

  position: absolute;

  right: 0;

  width: 100%;

}






    </style>





 <link rel="stylesheet" type="text/css" href="https://dj-clique-chatroom-new.herokuapp.com/style.css">



<script src="https://dj-clique-chatroom-new.herokuapp.com/socket.io/socket.io.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>

<script src="http://djclique.com/javascripts/jquery.cssemoticons.js" type="text/javascript"></script>
<link href="http://djclique.com/stylesheets/jquery.cssemoticons.css" media="screen" rel="stylesheet" type="text/css" />


</head>
<body>

       <script type="text/javascript">

            /**

             * @param {string} filename The name of the file WITHOUT ending

             */

            function playSound(filename){   

                document.getElementById("sound").innerHTML='<audio autoplay="autoplay"><source src="' + filename + '.mp3" type="audio/mpeg" /><source src="' + filename + '.ogg" type="audio/ogg" /><embed hidden="true" autostart="true" loop="false" src="' + filename +'.mp3" /></audio>';

            }



        </script>



<script>

//========================================================================================
//========================================================================================
//========================================================================================



 //========================================================================================
//========================================================================================
//========================================================================================



var currentVid;
var currentVid2;


function sendPause(){
	document.getElementById("data").value = 'pause99';
	document.getElementById("datasend").click();
}
function sendPlay(){
	document.getElementById("data").value = 'play99';
	document.getElementById("datasend").click();
}
function sendSeek(t){
	//document.getElementById("data").value = 'seek99-'+t;
	//document.getElementById("datasend").click();
}
function sendNext(){
	document.getElementById("data").value = 'next99';
	document.getElementById("datasend").click();
}
function sendPrev(){
	document.getElementById("data").value = 'prev99';
	document.getElementById("datasend").click();
}
function sendLoad(){
	document.getElementById("data").value = 'load99';
	document.getElementById("datasend").click();
}

function sendQueue(){
	document.getElementById("data").value = 'queue99';
	document.getElementById("datasend").click();
}

function sendFetch(){
	document.getElementById("data").value = 'fetch99';
	document.getElementById("datasend").click();
}

function sendRefresh(){
	document.getElementById("data").value = 'refresh99';
	document.getElementById("datasend").click();
}

function sendMute(){
	document.getElementById("data").value = 'mute99';
	document.getElementById("datasend").click();
}

function sendUnmute(){
	document.getElementById("data").value = 'unmute99';
	document.getElementById("datasend").click();
}

function repeatOn(){
	document.getElementById("data").value = 'repeatOn99';
	document.getElementById("datasend").click();
}

function repeatOff(){
	document.getElementById("data").value = 'repeatOff99';
	document.getElementById("datasend").click();
}

function shuffleOn(){
	document.getElementById("data").value = 'shuffleOn99';
	document.getElementById("datasend").click();
}

function shuffleOff(){
	document.getElementById("data").value = 'shuffleOff99';
	document.getElementById("datasend").click();
}

function keepAlive(){
	document.getElementById("data").value = 'keepAlive99';
	document.getElementById("datasend").click();
}
//------------------------------------------

function sendVid(vid){

var tempVid2
	if (vid.indexOf("sendvid") >= 0) {
			tempVid2 = vid;
			tempVid2 = tempVid2.slice(8);
			//alert(tempVid2);

		}

	document.getElementById("data").value = 'sendvid-'+tempVid2;
	document.getElementById("datasend").click();
}

function seekTo(t){

var tempTime2

	if (t.indexOf("seekTo") >= 0) {
			tempTime2 = t;
			tempTime2 = tempTime2.slice(7);
			//alert(tempTime2);

		}

	document.getElementById("data").value = 'seekTo-'+tempTime2;
	document.getElementById("datasend").click();
}


//========================================================================================
//========================================================================================
//========================================================================================
</script>



<script>
//------------------------------------------------------
/**

 * Get the value of a querystring

 * @param  {String} field The field to get the value of

 * @param  {String} url   The URL to get the value from (optional)

 * @return {String}       The field value

 */

var getQueryString = function ( field, url ) {

    var href = url ? url : window.location.href;

    var reg = new RegExp( '[?&]' + field + '=([^&#]*)', 'i' );

    var string = reg.exec(href);

    return string ? string[1] : null;

};


	var thisOne = getQueryString('room'); 
	var myUserId = getQueryString('userid'); 

//alert(thisOne);

//---------------------------------------------------------

//--------------------------
function escapeOutput(toOutput){

    return toOutput.replace('&','&amp;').replace('<','&lt;').replace('>','&gt;').replace('"','&quot;').replace("'",'&#x27').replace('/','&#x2F');

}
//--------------------------
function getRandomizer(bottom, top) {

    return function() {

        return Math.floor( Math.random() * ( 1 + top - bottom ) ) + bottom;

    }

}
//-------------------------------------------------------

function sanitizeString(str){

    str = str.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,"");

    return str.trim();

}


//--------------------------




//---------------------------
//////function connect(){


//=========================================================================================
//=========================================================================================



var socket = io.connect('ws://dj-clique-chatroom-new.herokuapp.com:8080')



var tryReconnect = function(){



    if (socket.socket.connected === false &&

        socket.socket.connecting === false) {

        // use a connect() or reconnect() here if you want


        socket.socket.connect()
	//socket.socket.reconnect()

   }

}



var intervalID = setInterval(tryReconnect, 1000)



socket.on('connect', function () {

    // once client connects, clear the reconnection interval function
	socket.emit('adduser', 'DJ Guest'+Math.floor((Math.random() * 1000000) + 1));

   	

	socket.emit('switchRoom', thisOne);


	console.log(thisOne);
	clearInterval(intervalID);


	//... do other stuff


});


//=========================================================================================
//=========================================================================================



	// listener, whenever the server emits 'updatechat', this updates the chat body

	socket.on('updatechat', function (username, data) {

//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------

//-------------------------------------------------------

		if (data.indexOf("sendvid") >= 0 )   {

			//alert(data);
			//var thisVid2;
			var thisVid2 = data;

			thisVid2 = thisVid2.substring(thisVid2.indexOf("sendvid-") + 8);

			////alert('thisvid2:'+thisVid2);

			top.postMessage("sendvid-"+thisVid2, 'http://djclique.com');
			
		}
		if (data.indexOf("seekTo") >= 0 )   {

			//alert(data);
			//var thisTime2;
			var thisTime2 = data;

			thisTime2 = thisTime2.substring(thisTime2.indexOf("seekTo-") + 7);

			////alert('thisvid2:'+thisVid2);

			top.postMessage("seekTo-"+thisTime2, 'http://djclique.com');
			
		}
		if (data.indexOf("play99") >= 0 )   {
			//top.postMessage(currentTrackTime, 'http://djclique.com');
			top.postMessage("playVideo", 'http://djclique.com');

		}
		if (data.indexOf("pause99") >= 0 )   {

			top.postMessage("pauseVideo", 'http://djclique.com');

		}
		if (data.indexOf("seek99") >= 0 || data.indexOf("seekVideo") >= 0 )   {

			//top.postMessage("seekVideo-"+currentTrackTime, 'http://djclique.com');

		}
		if (data.indexOf("next99") >= 0 )   {

			top.postMessage("nextVideo", 'http://djclique.com');

		}
		if (data.indexOf("prev99") >= 0 )   {

			top.postMessage("prevVideo", 'http://djclique.com');

		}
		if (data.indexOf("load99") >= 0 )   {

			top.postMessage("loadList", 'http://djclique.com');

		}
		if (data.indexOf("queue99") >= 0 )   {

			top.postMessage("queueList", 'http://djclique.com');

		}
		if (data.indexOf("fetch99") >= 0 )   {

			top.postMessage("fetchList", 'http://djclique.com');

		}
		if (data.indexOf("refresh99") >= 0 )   {

			top.postMessage("refreshPage", 'http://djclique.com');

		}
		if (data.indexOf("mute99") >= 0 )   {

			top.postMessage("mute", 'http://djclique.com');

		}
		if (data.indexOf("unmute99") >= 0 )   {

			top.postMessage("unmute", 'http://djclique.com');

		}
		if (data.indexOf("keepAlive99") >= 0 )   {

			top.postMessage("keepAlive", 'http://djclique.com');

		} 

//-------------------------------------------------------
//-------------------------------------------------
//-------------------------------------------------------

		if (data.indexOf("repeatOn99") >= 0 )   {

			top.postMessage("repeatOn", 'http://djclique.com');

		}
		if (data.indexOf("repeatOff99") >= 0 )   {

			top.postMessage("repeatOff", 'http://djclique.com');

		}
		if (data.indexOf("shuffleOn99") >= 0 )   {

			top.postMessage("shuffleOn", 'http://djclique.com');

		}
		if (data.indexOf("shuffleOff99") >= 0 )   {

			top.postMessage("shuffleOff", 'http://djclique.com');

		}  
		
		
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------

		

if (data != '' && data.indexOf("TrackTimeID") ==-1 && data.indexOf("pause99") ==-1 && data.indexOf("play99") ==-1 && data.indexOf("next99") ==-1 && data.indexOf("prev99") ==-1 && data.indexOf("onevid99") ==-1  && data.indexOf("load99") ==-1 && data.indexOf("sendvid") == -1 && data.indexOf("seekTo") == -1 && data.indexOf("repeatOn99") == -1 && data.indexOf("repeatOff99") == -1 && data.indexOf("shuffleOn99") == -1  && data.indexOf("shuffleOff99") == -1  && data.indexOf("keepAlive99") == -1 )   {


//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------


	


		$('#conversation').append('<b>'+escapeOutput(username) + ':</b> ' + escapeOutput(data) + '<br>');

		 ///$conversation[0].scrollTop = $conversation[0].scrollHeight;
		window.scrollTo(0, document.body.scrollHeight);
		$('#conversation').emoticonize();


	playSound('http://djclique.com/bing');

	}



	});



//=========================================================================================
//=========================================================================================
//=========================================================================================



	// listener, whenever the server emits 'updaterooms', this updates the room the client is in

	socket.on('updaterooms', function(rooms, current_room) {

		$('#rooms').empty();

		$.each(rooms, function(key, value) {

			if(value == current_room){

				$('#rooms').append('<div>' + value + '</div>');

			}

			else {

				$('#rooms').append('<div><a href="#" onclick="switchRoom(\''+value+'\')">' + value + '</a></div>');

			}

		});

	});



	function switchRoom(room){

		//socket.emit('switchRoom', thisOne);
		socket.emit('switchRoom', room);

	}

	

	// on load of page

	$(function(){

		// when the client clicks SEND

		$('#datasend').click( function() {

			var message = $('#data').val();

			$('#data').val('');

			// tell server to execute 'sendchat' and send along one parameter
			if (message != ''){

				socket.emit('sendchat', message);
			}

		});



		// when the client hits ENTER on their keyboard

		$('#data').keypress(function(e) {

			if(e.which == 13) {

				$(this).blur();

				$('#datasend').focus().click();
				$('#data').focus().click();
				

			}

		});

	});






window.onload = function(e){ 
	switchRoom(thisOne);
	$('#data').focus().click();
	//alert(thisOne);
}



//////}
///////connect();

</script>



<!--

<div style="float:left;width:100px;border-right:1px solid black;height:300px;padding:10px;overflow:scroll-y;">

	<b>ROOMS</b>

	<div id="rooms"></div>

</div>
-->



<div style="float:left;width:300px;height:250px;overflow:scroll-y;padding:10px;padding-bottom:100px;">

	<div id="conversation" style="padding-bottom:60px;"></div>

	<!--<input id="data" style="width:200px;" />-->

	<!--<input type="button" id="datasend" value="send" />-->

<!--<div id="conversation" ></div>
--!>
	</div>



	<div id="welcome"></div>
  <!--  <ul id="messages"></ul>-->


 

    <form >
	<!--<div id="message" name="message">-->

 <input id="data" size="50" name="data" autocomplete="off" placeholder="Type your message here" />


 <button name="datasend" id="datasend" onclick="return false;">&rArr;</button>

	</div>

    </form>












    <script>


           //top.postMessage('hello', 'http://djclique.com');

////window.onload = function () {
		//top.postMessage(currentTrackTime, 'http://djclique.com');
///};









        window.addEventListener( "message",

          function (e) {

                if(e.origin !== 'http://djclique.com'){ return; } 

               //alert(e.data);
		/////////////////console.log(e.data);
		currentTrackTime = e.data;

		var tempVid;
		var tempTime;
	
		//alert(e.data);

		if (e.data.indexOf("sendvid") >= 0) {
			tempVid = e.data;
			tempVid = tempVid.slice(8);
			//alert(tempVid);
			////alert(currentVid2);
			currentVid2 = tempVid;
			sendVid('sendvid-'+currentVid2);
			/////alert('from messenger: '+currentVid2);
			
		}
		if (e.data.indexOf("seekTo") >= 0) {
			tempTime = e.data;
			//tempTime = tempTime.slice(6);
			//////tempTime = tempTime.replace(/-/g, "");	

			//alert(tempTime);
			////alert(currentVid2);
			currentTime2 = tempTime;
			seekTo('seekTo-'+currentTime2);
			/////alert('from messenger: '+currentVid2);

		}
		if (e.data === 'playVideo') {
			sendPlay();

		}
		if (e.data === 'pauseVideo') {
			sendPause();

		}
		if (e.data === 'nextVideo') {
			sendNext();
		}
		if (e.data === 'prevVideo') {
			sendPrev();
		}
		if (e.data === 'loadList') {
			sendLoad();
		}
		if (e.data === 'queueList') {
			sendQueue();
		}
		if (e.data === 'fetchList') {
			sendFetch();
		}
		if (e.data === 'refreshPage') {
			sendRefresh();		
		}
		if (e.data === 'seekVideo') {
			sendSeek();
		
		}
		if (e.data === 'keepAlive') {
			keepAlive();
		
		} 

//-------------------------------------------------------
//-------------------------------------------------------

		if (e.data === 'sendMute') {
			sendMute();
		}
		if (e.data === 'sendUnmute') {
			sendUnmute();

		} 

//-------------------------------------------------------
//-------------------------------------------------------

		if (e.data === 'repeatOn') {
			repeatOn();
		}
		if (e.data === 'repeatOff') {
			repeatOff();
		}

//-------------------------------------------------------
//-------------------------------------------------------

		if (e.data === 'shuffleOn') {
			shuffleOn();
		}
		if (e.data === 'shuffleOff') {
			shuffleOff();
		}
		
//-------------------------------------------------------
//-------------------------------------------------------		


          },

          false);

//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------


    </script>

<div id="sound"></div>


</body>
</html>
